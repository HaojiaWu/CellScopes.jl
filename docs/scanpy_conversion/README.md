## Conversion of scanpy anndata to CellScopes object
If there is existing AnnData generated from the standard Scanpy pipeline and saved on the hard drive in hdf5 format, we offer a function to directly read this file and transform it into a corresponding ```CellScopes``` object. The current version supports the conversion of scRNA-seq, Xenium, and Visium data from Scanpy. Please note that Scanpy must be pre-installed in your current environment. This can be done by following the instructions in the Scanpy tutorial.:
https://scanpy.readthedocs.io/en/stable/installation.html
```julia
import CellScopes as cs
```
#### 1. From scRNA anndata
We created a function called ```from_scanpy``` to read the h5ad file and convert it to a ```scRNAObject``` in CellScopes. The h5ad file ```pbmc3k.h5ad``` below was created following a tutorial for processing a PBMC dataset.
https://scanpy-tutorials.readthedocs.io/en/latest/pbmc3k.html
```julia
scanpy_sc = cs.from_scanpy("pbmc3k.h5ad"; data_type="scRNA", anno="leiden")
```
This should create a scRNAObject that is suitable for downstream analysis or visiualization using CellScopes.
```
scRNAObject in CellScopes.jl
Genes x Cells = 1838 x 2638
Available data:
- Raw count
- Normalized count
- Scaled count
- Clustering data
- UMAP data
All fields:
- rawCount
- normCount
- scaleCount
- metaData
- varGene
- dimReduction
- clustData
- undefinedData
```
##### 1.1 Visualize cells
```julia
cs.dim_plot(scanpy_sc; anno = "leiden", marker_size=5)
```
<img src="https://github.com/HaojiaWu/CellScopes.jl/blob/main/data/scanpy_sc_umap.png" width="400"> <br>
##### 1.2 Visualize genes
```julia
cs.feature_plot(scanpy_sc, ["CST3", "NKG7", "PPBP"]; marker_size=6, dim_type="umap")
```
<img src="https://github.com/HaojiaWu/CellScopes.jl/blob/main/data/scanpy_sc_genes.png" width="1200"> <br>

#### 2. From Xenium anndata
Below is to convert xenium data from scanpy to ```CellScopes```. The Xenium data was generated by this squidpy tutorial.
https://squidpy.readthedocs.io/en/latest/notebooks/tutorials/tutorial_xenium.html
```julia
scanpy_xenium = cs.from_scanpy("squidpy.h5ad"; 
    data_type="spatial",
    tech="xenium", 
    sp_coord_name="spatial", 
    anno="leiden")
```
This command above should create a SpatialObject in CellScopes.
```
ImagingSpatialObject in CellScopes.jl
Genes x Cells = 313 x 164079
Available data:
- rawCount
- normCount
- scaleCount
- metaData
- spmetaData
- dimReduction
- clustData
- coordData
- polygonData
All fields:
- rawCount
- normCount
- scaleCount
- metaData
- spmetaData
- varGene
- dimReduction
- clustData
- polyCount
- polynormCount
- coordData
- imputeData
- imageData
- polygonData
```
Then we can use all the functions developped in CellScopes to analyze and visualize the data.
##### 2.1 Visualize clusters in umap
```julia
cs.dim_plot(scanpy_xenium; anno="leiden")
```
<img src="https://github.com/HaojiaWu/CellScopes.jl/blob/main/data/scanpy_xenium_umap.png" width="400"> <br>
##### 2.2 Visualize clusters in tissue
```julia
cs.sp_dim_plot(scanpy_xenium, "leiden"; canvas_size=(800, 600), marker_size=2)
```
<img src="https://github.com/HaojiaWu/CellScopes.jl/blob/main/data/scanpy_xenium_tissue.png" width="800"> <br>
##### 2.3 Visualize genes in tissue
```julia
cs.sp_feature_plot(scanpy_xenium, "CEACAM6"; 
    color_keys=["gray94", "lemonchiffon", "red"], 
    height=400, width=600, marker_size = 4)
```
<img src="https://github.com/HaojiaWu/CellScopes.jl/blob/main/data/scanpy_xenium_gene.png" width="600"> <br>

#### 3. From Visium anndata
Using the same from_scanpy function, Visium AnnData can also be converted into a CellScopes object. As an illustration, we used an example from a mouse brain created according to the instructions provided in the following tutorial:
https://squidpy.readthedocs.io/en/stable/notebooks/tutorials/tutorial_visium_hne.html
```julia
scanpy_visium = cs.from_scanpy("visium_scanpy.h5ad"; 
    data_type="spatial",
    tech="visium", 
    sp_coord_name="spatial", 
    anno="leiden")
```
This will create a VisiumObject in ```CellScopes```.
```
VisiumObject in CellScopes.jl
Genes x Cells = 18078 x 2688
Available data:
- rawCount
- normCount
- scaleCount
- metaData
- spmetaData
- dimReduction
- clustData
- imageData
All fields:
- rawCount
- normCount
- scaleCount
- metaData
- spmetaData
- varGene
- dimReduction
- clustData
- imageData
```
##### 3.1 Visualize clusters in tissue
```julia
cs.sp_dim_plot(scanpy_visium, "leiden"; 
    marker_size = 8, canvas_size = (600,500), 
    do_label=false, adjust_brightness=0.3, adjust_contrast=1.5,
    alpha=1,  img_res="low")
```
<img src="https://github.com/HaojiaWu/CellScopes.jl/blob/main/data/scanpy_visium_tissue.png" width="600"> <br>

##### 3.2 Visualize genes in tissue
```julia
cs.sp_feature_plot(brain, ["Olfm1", "Plp1", "Itpka"]; 
    marker_size = 8, color_keys=["gray90", "lemonchiffon1" ,"red"], 
    adjust_brightness=0.3, adjust_contrast=1.5, clip=1, alpha=(0.5,0.8),img_res="low")
```
<img src="https://github.com/HaojiaWu/CellScopes.jl/blob/main/data/scanpy_visium_genes.png" width="1200"> <br>

